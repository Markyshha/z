<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∏–Ω–∏–º–∞–ª –ó–∞–º–µ—Ç–∫–∏</title>
    <style>
        /* –ß—ë—Ä–Ω–æ-–±–µ–ª–∞—è –ø–∞–ª–∏—Ç—Ä–∞ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ */
        :root {
            --bg-color: #f8f8f8;
            --text-color: #222;
            --accent-color: #444;
            --border-color: #ddd;
            --shadow-color: rgba(0,0,0,0.1);
            --card-bg: white;
            --button-active: #e0e0e0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container {
            max-width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        
        h1 {
            text-align: center;
            font-weight: 300;
            margin: 12px 0;
            font-size: 24px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            animation: fadeIn 0.4s ease-out;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            background: none;
            border: none;
            font-size: 14px;
            color: var(--text-color);
            position: relative;
            transition: all 0.2s;
        }
        
        .tab.active {
            font-weight: bold;
        }
        
        .tab.active:after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 25%;
            width: 50%;
            height: 2px;
            background: var(--text-color);
            animation: fadeIn 0.3s;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 4px;
            box-shadow: 0 1px 3px var(--shadow-color);
            margin-bottom: 12px;
            padding: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:active {
            transform: scale(0.99);
            box-shadow: 0 1px 1px var(--shadow-color);
        }
        
        textarea {
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px;
            box-sizing: border-box;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 14px;
            margin-bottom: 8px;
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        .button {
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px 16px;
            font-size: 14px;
            margin-right: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .button:active {
            background: var(--button-active);
            transform: scale(0.96);
        }
        
        .button.primary {
            background: var(--text-color);
            color: var(--bg-color);
            border-color: var(--text-color);
        }
        
        .button.primary:active {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .button-icon {
            margin-right: 6px;
            font-size: 16px;
        }
        
        .note {
            margin-bottom: 12px;
            animation: fadeIn 0.3s;
        }
        
        .note-content {
            margin-bottom: 8px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .note-image {
            max-width: 100%;
            max-height: 200px;
            display: block;
            margin: 8px 0;
            border-radius: 2px;
        }
        
        .audio-player {
            width: 100%;
            margin: 8px 0;
        }
        
        .note-date {
            font-size: 12px;
            color: var(--accent-color);
            margin-top: 4px;
        }
        
        .note-actions {
            margin-top: 8px;
            display: flex;
        }
        
        .note-actions .button {
            padding: 6px 10px;
            font-size: 12px;
        }
        
        .recording {
            animation: pulse 1.5s infinite;
        }
        
        .hidden {
            display: none;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Lumia 640 LTE */
        @media (max-width: 480px) {
            .button {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            .tab {
                padding: 10px 0;
                font-size: 13px;
            }
            
            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ú–∏–Ω–∏–º–∞–ª –ó–∞–º–µ—Ç–∫–∏</h1>
        
        <div class="tabs">
            <button class="tab active" data-tab="text">–¢–µ–∫—Å—Ç</button>
            <button class="tab" data-tab="voice">–ì–æ–ª–æ—Å</button>
            <button class="tab" data-tab="image">–§–æ—Ç–æ</button>
        </div>
        
        <div id="text-tab" class="tab-content active">
            <div class="card">
                <textarea id="note-text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É..."></textarea>
                <button class="button primary" id="add-text-note">
                    <span class="button-icon">üìù</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
        
        <div id="voice-tab" class="tab-content">
            <div class="card">
                <button class="button" id="record-button">
                    <span class="button-icon">üé§</span> –ó–∞–ø–∏—Å—å
                </button>
                <button class="button primary hidden" id="save-button" disabled>
                    <span class="button-icon">üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
                <audio id="audio-playback" controls class="audio-player hidden"></audio>
                <div id="recording-status" class="hidden" style="font-size: 12px; margin-top: 8px;">
                    –ò–¥—ë—Ç –∑–∞–ø–∏—Å—å... <span class="recording">‚óè</span>
                </div>
            </div>
        </div>
        
        <div id="image-tab" class="tab-content">
            <div class="card">
                <input type="file" id="image-input" accept="image/*" style="display: none;">
                <button class="button" id="select-image">
                    <span class="button-icon">üñºÔ∏è</span> –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
                </button>
                <span id="image-name" style="font-size: 12px; margin-left: 8px;"></span>
                <textarea id="image-note-text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ..." style="margin-top: 8px;"></textarea>
                <button class="button primary" id="add-image-note">
                    <span class="button-icon">üì∏</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
        
        <div id="notes-list" style="margin-top: 16px;"></div>
    </div>
    
    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.dataset.tab + '-tab').classList.add('active');
            });
        });
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.button').forEach(button => {
            button.addEventListener('mousedown', function() {
                this.classList.add('active');
            });
            
            button.addEventListener('mouseup', function() {
                this.classList.remove('active');
            });
            
            button.addEventListener('mouseleave', function() {
                this.classList.remove('active');
            });
        });
        
        // –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏
        document.getElementById('add-text-note').addEventListener('click', addTextNote);
        
        function addTextNote() {
            const text = document.getElementById('note-text').value.trim();
            if (text) {
                const note = {
                    type: 'text',
                    content: text,
                    date: new Date()
                };
                saveNote(note);
                document.getElementById('note-text').value = '';
                renderNotes();
            }
        }
        
        // –ì–æ–ª–æ—Å–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏
        const recordButton = document.getElementById('record-button');
        const saveButton = document.getElementById('save-button');
        const recordingStatus = document.getElementById('recording-status');
        
        let mediaRecorder;
        let audioChunks = [];
        
        recordButton.addEventListener('click', toggleRecording);
        saveButton.addEventListener('click', saveRecording);
        
        function toggleRecording() {
            if (recordButton.textContent.includes('–ó–∞–ø–∏—Å—å')) {
                startRecording();
                recordButton.innerHTML = '<span class="button-icon">‚èπÔ∏è</span> –°—Ç–æ–ø';
                saveButton.classList.add('hidden');
                recordingStatus.classList.remove('hidden');
            } else {
                stopRecording();
                recordButton.innerHTML = '<span class="button-icon">üé§</span> –ó–∞–ø–∏—Å—å';
                recordingStatus.classList.add('hidden');
            }
        }
        
        function startRecording() {
            audioChunks = [];
            
            // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å IE Mobile
            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || 
                                    navigator.mozGetUserMedia || navigator.msGetUserMedia;
            
            if (navigator.getUserMedia) {
                navigator.getUserMedia({ audio: true },
                    function(stream) {
                        mediaRecorder = new MediaRecorder(stream);
                        
                        mediaRecorder.ondataavailable = function(event) {
                            audioChunks.push(event.data);
                        };
                        
                        mediaRecorder.start();
                    },
                    function(err) {
                        alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: ' + err.name);
                    }
                );
            } else {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ');
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                mediaRecorder.onstop = function() {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audioPlayback = document.getElementById('audio-playback');
                    
                    audioPlayback.src = audioUrl;
                    audioPlayback.classList.remove('hidden');
                    saveButton.disabled = false;
                    saveButton.classList.remove('hidden');
                    
                    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –º–∏–∫—Ä–æ—Ñ–æ–Ω
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());
                };
            }
        }
        
        function saveRecording() {
            const audioPlayback = document.getElementById('audio-playback');
            if (audioPlayback.src) {
                const note = {
                    type: 'voice',
                    content: '–ì–æ–ª–æ—Å–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞',
                    audioUrl: audioPlayback.src,
                    date: new Date()
                };
                
                saveNote(note);
                renderNotes();
                
                // –°–±—Ä–æ—Å
                audioPlayback.src = '';
                audioPlayback.classList.add('hidden');
                saveButton.disabled = true;
                saveButton.classList.add('hidden');
            }
        }
        
        // –ó–∞–º–µ—Ç–∫–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        document.getElementById('select-image').addEventListener('click', function() {
            document.getElementById('image-input').click();
        });
        
        document.getElementById('image-input').addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                document.getElementById('image-name').textContent = file.name;
            }
        });
        
        document.getElementById('add-image-note').addEventListener('click', addImageNote);
        
        function addImageNote() {
            const fileInput = document.getElementById('image-input');
            const text = document.getElementById('image-note-text').value.trim();
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const note = {
                        type: 'image',
                        content: text || '–§–æ—Ç–æ –∑–∞–º–µ—Ç–∫–∞',
                        imageUrl: e.target.result,
                        date: new Date()
                    };
                    
                    saveNote(note);
                    renderNotes();
                    
                    // –°–±—Ä–æ—Å
                    fileInput.value = '';
                    document.getElementById('image-note-text').value = '';
                    document.getElementById('image-name').textContent = '';
                };
                
                reader.readAsDataURL(file);
            } else if (text) {
                const note = {
                    type: 'text',
                    content: text,
                    date: new Date()
                };
                
                saveNote(note);
                renderNotes();
                document.getElementById('image-note-text').value = '';
            }
        }
        
        // –†–∞–±–æ—Ç–∞ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏
        function saveNote(note) {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            notes.push(note);
            localStorage.setItem('notes', JSON.stringify(notes));
        }
        
        function deleteNote(index) {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            notes.splice(index, 1);
            localStorage.setItem('notes', JSON.stringify(notes));
            renderNotes();
        }
        
        function renderNotes() {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            const notesList = document.getElementById('notes-list');
            
            notesList.innerHTML = '<h2 style="margin-bottom: 12px;">–í–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏</h2>';
            
            if (notes.length === 0) {
                notesList.innerHTML += '<div class="card" style="text-align: center; color: var(--accent-color);">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</div>';
                return;
            }
            
            notes.reverse().forEach((note, index) => {
                const noteElement = document.createElement('div');
                noteElement.className = 'note card';
                
                const content = document.createElement('div');
                content.className = 'note-content';
                content.textContent = note.content;
                
                const date = document.createElement('div');
                date.className = 'note-date';
                date.textContent = formatDate(note.date);
                
                const actions = document.createElement('div');
                actions.className = 'note-actions';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'button';
                deleteBtn.innerHTML = '<span class="button-icon">üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å';
                deleteBtn.addEventListener('click', () => deleteNote(notes.length - 1 - index));
                
                noteElement.appendChild(content);
                
                if (note.type === 'image' && note.imageUrl) {
                    const img = document.createElement('img');
                    img.className = 'note-image';
                    img.src = note.imageUrl;
                    noteElement.appendChild(img);
                }
                
                if (note.type === 'voice' && note.audioUrl) {
                    const audio = document.createElement('audio');
                    audio.className = 'audio-player';
                    audio.controls = true;
                    audio.src = note.audioUrl;
                    noteElement.appendChild(audio);
                }
                
                noteElement.appendChild(date);
                actions.appendChild(deleteBtn);
                noteElement.appendChild(actions);
                
                notesList.appendChild(noteElement);
            });
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            renderNotes();
            
            // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å IE Mobile
            if (!window.MediaRecorder) {
                document.getElementById('voice-tab').innerHTML = `
                    <div class="card" style="text-align: center;">
                        <p>–ì–æ–ª–æ—Å–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>